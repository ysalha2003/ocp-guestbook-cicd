<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√§stbok - OpenShift Lab</title>
    <style>
        /* ... (keep all your existing CSS) ... */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù G√§stbok</h1>
            <p>OpenShift Lab - Distribuerad Applikation</p>
            <div class="ci-banner">
                <h2>üöÄ Deployed: <span id="deploymentTime">Loading...</span></h2>
            </div>
            <div class="live-clock">
                Aktuell tid: <span id="liveClock" class="clock-time">--:--:--</span> | 
                <span id="timeSinceDeployment">Ber√§knar...</span>
            </div>
        </div>
        
        <!-- ... rest of your HTML ... -->
    </div>

    <script>
        // Deployment timestamp - will be set at build time
        const DEPLOYMENT_TIMESTAMP = '__DEPLOYMENT_TIMESTAMP__';
        
        // Live clock functionality
        function updateLiveClock() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            document.getElementById('liveClock').textContent = `${hours}:${minutes}:${seconds}`;
            
            // Update server time in stats
            const serverTimeEl = document.getElementById('serverTime');
            if (serverTimeEl) {
                serverTimeEl.textContent = `${hours}:${minutes}`;
            }
            
            // Update time since deployment
            updateTimeSinceDeployment();
        }
        
        function updateTimeSinceDeployment() {
            if (DEPLOYMENT_TIMESTAMP === '__DEPLOYMENT_TIMESTAMP__') {
                // Fallback if build-time replacement didn't happen
                document.getElementById('timeSinceDeployment').textContent = 
                    'Deployed: Just now';
                return;
            }
            
            const deployedAt = new Date(DEPLOYMENT_TIMESTAMP);
            const now = new Date();
            const diffMs = now - deployedAt;
            
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            let timeAgo;
            if (diffDays > 0) {
                timeAgo = `${diffDays} dag${diffDays > 1 ? 'ar' : ''} sedan`;
            } else if (diffHours > 0) {
                timeAgo = `${diffHours} timm${diffHours > 1 ? 'ar' : 'e'} sedan`;
            } else if (diffMins > 0) {
                timeAgo = `${diffMins} minut${diffMins > 1 ? 'er' : ''} sedan`;
            } else {
                timeAgo = 'Just nu';
            }
            
            document.getElementById('timeSinceDeployment').textContent = 
                `Deployed ${timeAgo}`;
        }
        
        function formatDeploymentTime() {
            if (DEPLOYMENT_TIMESTAMP === '__DEPLOYMENT_TIMESTAMP__') {
                return new Date().toLocaleString('sv-SE', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    timeZone: 'Europe/Stockholm'
                });
            }
            
            const deployedAt = new Date(DEPLOYMENT_TIMESTAMP);
            return deployedAt.toLocaleString('sv-SE', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZone: 'Europe/Stockholm'
            }) + ' CET';
        }
        
        // Initial updates
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('deploymentTime').textContent = formatDeploymentTime();
            updateLiveClock();
        });
        
        // Update clock every second
        setInterval(updateLiveClock, 1000);
        
        // ... rest of your existing JavaScript ...
        
        async function loadEntries() {
            try {
                const response = await fetch('/api/entries');
                const entries = await response.json();
                const cacheStatus = response.headers.get('X-Cache');
                
                const entriesList = document.getElementById('entriesList');
                
                if (entries.length === 0) {
                    entriesList.innerHTML = '<div class="entry">Inga inl√§gg √§n. Var den f√∂rsta att skriva!</div>';
                    return;
                }
                
                entriesList.innerHTML = entries.map(entry => `
                    <div class="entry">
                        <div class="entry-header">
                            <span class="entry-name">${escapeHtml(entry.name)}</span>
                            <span class="entry-date">
                                ${new Date(entry.created_at).toLocaleDateString('sv-SE')} 
                                ${new Date(entry.created_at).toLocaleTimeString('sv-SE')}
                            </span>
                        </div>
                        <div class="entry-message">${escapeHtml(entry.message)}</div>
                    </div>
                `).join('');
                
                const cacheStatusEl = document.getElementById('cacheStatus');
                if (cacheStatusEl) {
                    cacheStatusEl.textContent = cacheStatus === 'HIT' ? '‚úì' : '‚óã';
                }
                
            } catch (error) {
                console.error('Fel vid laddning av inl√§gg:', error);
                document.getElementById('entriesList').innerHTML = 
                    '<div class="error">Kunde inte ladda inl√§gg. Kontrollera att backend-tj√§nsten k√∂rs.</div>';
            }
        }
        
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
                const totalEntriesEl = document.getElementById('totalEntries');
                if (totalEntriesEl) {
                    totalEntriesEl.textContent = stats.total_entries_db || 0;
                }
            } catch (error) {
                console.error('Fel vid laddning av statistik:', error);
            }
        }
        
        document.getElementById('entryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const message = document.getElementById('message').value;
            
            try {
                const response = await fetch('/api/entries', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, message })
                });
                
                if (response.ok) {
                    document.getElementById('entryForm').reset();
                    await loadEntries();
                    await loadStats();
                } else {
                    alert('Fel vid skapande av inl√§gg');
                }
            } catch (error) {
                console.error('Fel:', error);
                alert('Kunde inte skicka inl√§gg. Kontrollera att backend-tj√§nsten k√∂rs.');
            }
        });
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        loadEntries();
        loadStats();
        
        setInterval(() => {
            loadEntries();
            loadStats();
        }, 30000);
    </script>
</body>
</html>
